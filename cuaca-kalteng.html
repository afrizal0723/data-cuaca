<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prakiraan Cuaca 3 Kabupaten</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f9fafb;
        }
        .carousel-slide {
            min-height: 320px; /* Memastikan tinggi slide konsisten */
        }
    </style>
</head>
<body class="p-2">
    <!-- Kontainer Carousel -->
    <div id="carousel-container" class="relative w-full overflow-hidden rounded-lg shadow-md bg-white">
        <div id="carousel-slides" class="flex transition-transform duration-500 ease-in-out">
            <!-- Slides akan dimuat di sini oleh JavaScript -->
            <p class="w-full text-center text-gray-500 p-4">Memuat data prakiraan cuaca...</p>
        </div>
        <button id="prev-btn" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black bg-opacity-30 text-white p-2 rounded-full hover:bg-opacity-50 hidden">
            &#10094;
        </button>
        <button id="next-btn" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black bg-opacity-30 text-white p-2 rounded-full hover:bg-opacity-50 hidden">
            &#10095;
        </button>
    </div>

    <script>
        async function fetchAllWeatherData() {
            const container = document.getElementById('carousel-slides');
            
            const locations = [
                { name: 'Kotawaringin Barat', code: '62.01.02.1006' }, // Pasir Panjang
                { name: 'Lamandau', code: '62.08.01.1001' },          // Nanga Bulik
                { name: 'Sukamara', code: '62.07.01.1001' }           // Mendawai
            ];

            try {
                // Mengambil data untuk semua lokasi secara bersamaan
                const responses = await Promise.all(
                    locations.map(loc => {
                        const dataUrl = `https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=${loc.code}`;
                        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(dataUrl)}`;
                        return fetch(proxyUrl);
                    })
                );

                // Memproses semua respons menjadi JSON
                const weatherData = await Promise.all(responses.map(res => {
                    if (!res.ok) throw new Error(`Gagal mengambil data: ${res.statusText}`);
                    return res.json();
                }));

                container.innerHTML = ''; // Kosongkan tulisan "Memuat data..."

                weatherData.forEach(data => {
                    if (data.error) throw new Error(data.error);

                    const location = data.lokasi;
                    const forecastDays = data.data[0].cuaca;

                    let slideContent = `
                        <div class="border-b pb-3 mb-3">
                            <h2 class="text-xl font-bold text-blue-800">${location.kotkab}</h2>
                            <p class="text-sm text-gray-600">${location.kecamatan}, ${location.desa}</p>
                        </div>
                        <div class="space-y-3 text-xs overflow-y-auto" style="max-height: 250px;">
                    `;

                    // Hanya menampilkan prakiraan untuk hari pertama
                    const todayForecast = forecastDays[0];
                    const date = new Date(todayForecast[0].local_datetime);
                    const dayName = date.toLocaleDateString('id-ID', { weekday: 'long' });
                    const fullDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long' });

                    slideContent += `<div><h3 class="font-semibold text-gray-700 mb-2">${dayName}, ${fullDate}</h3><div class="space-y-1">`;
                    
                    todayForecast.forEach(forecast => {
                        const time = new Date(forecast.local_datetime).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                        const iconUrl = `https://www.bmkg.go.id/asset/img/weather_icon/ID/${forecast.weather_code}.png`;
                        
                        slideContent += `
                            <div class="bg-gray-50 p-1.5 rounded-md flex items-center justify-between flex-wrap">
                                <span class="font-medium w-1/4 text-center">${time}</span>
                                <span class="flex items-center w-1/2">
                                    <img src="${iconUrl}" alt="${forecast.weather_desc}" class="w-5 h-5 mr-1">
                                    ${forecast.weather_desc}
                                </span>
                                <span class="text-blue-600 font-semibold w-1/4 text-right">${forecast.t}Â°C</span>
                            </div>
                        `;
                    });
                    slideContent += `</div></div>`;

                    slideContent += `</div>`;
                    
                    const slide = document.createElement('div');
                    slide.className = 'w-full flex-shrink-0 p-4 carousel-slide';
                    slide.innerHTML = slideContent;
                    container.appendChild(slide);
                });

                initializeCarousel();

            } catch (error) {
                container.innerHTML = '<p class="w-full text-center text-red-500 p-4">Gagal memuat data cuaca. Layanan mungkin sedang tidak tersedia.</p>';
                console.error(error);
            }
        }

        function initializeCarousel() {
            const slidesContainer = document.getElementById("carousel-slides");
            const prevButton = document.getElementById("prev-btn");
            const nextButton = document.getElementById("next-btn");
            const slides = document.querySelectorAll("#carousel-slides > div");
            
            if (slides.length <= 1) return;

            prevButton.classList.remove('hidden');
            nextButton.classList.remove('hidden');

            let currentSlide = 0;
            const slideCount = slides.length;

            function goToSlide(slideIndex) {
                slidesContainer.style.transform = `translateX(-${slideIndex * 100}%)`;
                currentSlide = slideIndex;
            }

            nextButton.addEventListener("click", () => {
                goToSlide((currentSlide + 1) % slideCount);
            });

            prevButton.addEventListener("click", () => {
                goToSlide((currentSlide - 1 + slideCount) % slideCount);
            });

            if (window.carouselInterval) clearInterval(window.carouselInterval);
            window.carouselInterval = setInterval(() => {
                nextButton.click();
            }, 5000); // Ganti slide setiap 5 detik
        }

        fetchWeatherData();
    </script>
</body>
</html>
